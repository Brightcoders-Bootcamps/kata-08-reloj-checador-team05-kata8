version: 2.1
orbs:
  ruby: circleci/ruby@0.1.2
jobs:
    build:
      docker:
         - image: circleci/ruby:3.0.0-node
         - image: circleci/postgres
           environment:
             POSTGRES_USER: root
             POSTGRES_PASSWORD: teamkongmdfk00
      executor: ruby/default
      steps:
       - checkout
       - run:
           name: bundle install
           command: bundle install
       - ruby/bundle-install
       - run:
           name: yarn install
           command: yarn install --check-files
       - run:
           name: db create
           command: bundle exec rake db:create
       - run: 
           name: db load migrate
           command: bundle exec rake db:load
       - run:
           name: test
           command: bundle exec rspec